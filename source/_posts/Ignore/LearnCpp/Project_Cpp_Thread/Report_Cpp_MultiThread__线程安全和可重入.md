---
title: Cpp 多线程：线程安全和可重入
date: 2024-04-14 19:55:34
description: C++ 多线程
cover: https://raw.githubusercontent.com/shigure-no-wokka/pic_bed/main/imgs/family_code.jpg
categories: Code
tags:
  - 多线程
  - Cpp
---

# 线程安全的概念

某个函数、函数库**在多线程环境**下被调用，能够**正确处理各个线程之间的公用变量**，使得**程序功能正确完成**。

线程惯性：在多线程编程中的一种错误的心理状态，它总是假定当前编写的代码执行完后会立刻执行下一行代码。而实际上，现代处理器中，线程的时间片用完后会立刻被处理器冻结，并执行另一个线程。

# 可重入的概念

一个程序或子程序可以，**在任意时刻被中断**，操作系统执行另一段代码，这段代码**又使用了这个程序或子程序并且不会出错**。

# 二者的区别

线程安全不一定是可重入，可重入不一定线程安全。

可重入是单线程操作系统时代提出的，如果一个函数可重入，应当满足条件：
- 不能含有静态（全局）非常量数据
- 不能返回静态（全局）非常量数据的地址
- 只能处理调度者提供的数据
- 不能依赖于单例模式资源的锁
- 内部调用的函数也必须是可重入的
即，**可重入函数所使用的全部变量，都必须要在调用堆栈的当前函数栈上，从而保证重复调用该函数后新加入的函数帧与之前的函数帧不会发生冲突与覆盖**




